<!DOCTYPE html>
<html data-theme="dark">
  <head>
    
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" href="/assets/css/pico.css" />
<link rel="stylesheet" href="/assets/css/custom.css" />
<link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script> 


    <style>
      article {
        background: rgb(28, 29, 33);
        max-width: 70%;
        text-align: left;
        margin: 0 auto;
        border-radius: 30px;
      }
      p,
      li {
        font-size: 16.5px;
        line-height: 32px;
      }
      h1 {
        text-align: center;
        margin-bottom: 10px;
      }
      .meta p {
        text-align: center;
      }
      .date {
        text-align: center;
      }
      .toc {
        position: fixed;
        float: left;
        max-width: 50px;
        max-height: 50px;
        margin-top: 200px;
        text-align: center;
      }
      h2 {
        font-size: x-large;
        color: peru;
      }
      h3 {
        font-size: large;
        color: rgb(205, 158, 112);
      }
      h4 {
        font-size: medium;
        color: pink;
      }
      strong {
        color: rgb(182, 230, 240);
      }
    </style>
    <title>Wine 与 ATRI 与 .desktop</title>
  </head>
  <body onselectstart="return false">
    
<nav>
  <a href="/" class="logo">Maruka's Blog</a>
  <div class="breadcrumb">
    <ul>
      <li>
        <a href="/posts">文章</a>
      </li>
      <li>
        <a href="/category">分类</a>
      </li>
      <li>
        <a href="/about">关于</a>
      </li>
    </ul>
  </div>
</nav>

    <div>
      <div class="meta">
        <h1>Wine 与 ATRI 与 .desktop</h1>
        <p>2022-09-26T19:29:10&#43;08:00</p>
      </div>
      <article><h2 id="heading"><a class="anchor" href="#heading">#</a> 引言</h2>
<p>一定是闲得没事的人才会去把 ATRI 放在 Arch 上跑吧😂。平时在 Arch 上面跑 Osu！，而游玩其他游戏只能切换到 Win——这一整套流程想想就头疼。因此试着用 <code>Wine</code> 直接跑 ATRI，不想直接跑通，于是有了这篇文章。</p>
<p><img src="https://ghproxy.com/github.com/levinion/blog-pic/blob/main/img/ss_47e1f809fa56ab6d48de3c66e3147585b4ee30a2.600x338.jpg" alt="atri"></p>
<blockquote>
<p>ATRI 是一个很好的游戏，不过作为一个不怎么推 Gal 的人，对其也并没有多少发言权。本来是可以在 Steam 上购买的，无奈有些小贵，只得自寻旁门外道（笑），等日后补票。虽然我很喜欢开源社区的理念，认为其贯彻了互联网的共享精神，也并不反感所谓盗版；但我也不反对为开发者和游戏创作者的劳动付费。在付费和开源之间寻求平衡，也是互联网发展所必然面对的课题之一——然而今天要谈的不是这些。</p>
</blockquote>
<h2 id="-"><a class="anchor" href="#-">#</a> 🍷 喂《萝卜子》喝“红酒”</h2>
<p>说到 Linux 上的“红酒”，指的当然是大名鼎鼎的“Wine”。Wine 是类 Unix 操作系统上一个功能强大的软件，其提供了一个兼容层用以转译 Windows 系统命令。Wine 名称来自于“Wine Is Not an Emulator”，表明其不是一个模拟器，而其性能损失也确实微乎其微。对游戏改良的 Wine，也就是 Steam Deck 所使用的 proton 配合 Linux 甚至能够达到较 Windows 更低的延迟和更高的帧率。</p>
<p>我的游戏文件夹（除 osu 外）都位于 Windows 分区下的 D 盘，而 Arch 因为采用了 Btrfs 文件系统，能够直接对其进行读写，因此可以直接在该文件夹内运行。</p>
<ol>
<li>
<p>在 Arch 下挂载 Windows 下的 D 盘</p>
<blockquote>
<p>一般直接在文件管理器（我用的是 dolphin）中点击对应的磁盘，输入密码认证即可。如果厌倦了每次输入密码认证，我给出了解决办法，请继续往后看。</p>
</blockquote>
</li>
<li>
<p>使用 Wine 运行程序</p>
<pre><code class="language-sh"># 跳转到 exe 程序所在的文件夹
cd /run/media/maruka/data/games/ATRI.My.Dear.Moments/ATRI.My.Dear.Moments
# wine 运行 exe程序
wine ATRI.My.Dear.Moments/ATRI-MyDearMoments-.exe
</code></pre>
<blockquote>
<p>我这里 ATRI 的路径是 <code>/run/media/maruka/data/games/ATRI.My.Dear.Moments/ATRI.My.Dear.Moments/ATRI-MyDearMoments-.exe</code> <!-- raw HTML omitted --> 其中，磁盘一般挂载于 <code>/run/media/UserName/</code> 目录下，<code>data</code> 是我的 D 盘名称。为求方便，可以在文件管理器中找到游戏的 exe 文件，并将路径复制下来。</p>
</blockquote>
</li>
</ol>
<h2 id="--1"><a class="anchor" href="#--1">#</a> 🔗 创建一个快捷方式吧！</h2>
<ol>
<li>
<p>反正都在终端输入命令运行了，第一发想一定是创建一个 alias。</p>
<pre><code class="language-sh"># .config/fish/config.fish 或 .zshrc 或 .bashrc
alias atri=&quot;cd /run/media/maruka/data/games/ATRI.My.Dear.Moments/ATRI.My.Dear.Moments;wine ATRI.My.Dear.Moments/ATRI-MyDearMoments-.exe&quot;
</code></pre>
<blockquote>
<p>之所以没有采用 <code>wine /run/media/maruka/data/games/ATRI.My.Dear.Moments/ATRI.My.Dear.MomentsATRI.My.Dear.Moments/ATRI-MyDearMoments-.exe</code> 的方式运行，是因为本机报了错，大概是无法直接在另一系统硬盘上运行程序吧。所以先 cd 过去再运行。如果你运行出了问题，请尝试这样做。</p>
</blockquote>
</li>
<li>
<p>创建一个 Desktop Entry</p>
<blockquote>
<p>.desktop 是实现应用程序菜单的文件，通过创建该文件，可以在应用条目中查看到应用，方便使用 krunner 等程序快速唤起。该配置文件分为系统条目和用户条目。系统条目一般包括存于系统中、可供所有用户使用的应用程序，位于 <code>/usr/share/applications/</code> 或 <code>/usr/local/share/applications/</code> 文件夹中；用户条目优先级高于系统条目，一般位于 <code>~/.local/share/applications/</code> 文件夹中。</p>
</blockquote>
<pre><code class="language-sh"># .desktop 文件示例，机翻自 Arch Wiki
[Desktop Entry]

# 快捷方式类型
Type=Application

# 此文件遵循的桌面条目规范的版本
Version=1.0

# 应用名称
Name=jMemorize

# 可用做提示的内容
Comment=Flash card based learning tool

# 运行可执行文件的文件夹
Path=/opt/jmemorise

# 应用程序的可执行文件，可能带有参数。
Exec=jmemorize

# 将用于显示此条目的图标名称
Icon=jmemorize

# 描述此应用程序是否需要在终端中运行
Terminal=false

# 描述应显示此条目的类别
Categories=Education;Languages;Java;
</code></pre>
<blockquote>
<p>该配置文件除 <code>Type</code> 和 <code>Name</code> 外都是可选的。下面给出我的配置。</p>
</blockquote>
<pre><code class="language-sh">[Desktop Entry]  

Type= Application  

Name= ATRI-MyDear-Moments  

Path= /run/media/maruka/data/games/ATRI.My.Dear.Moments/ATRI. My.Dear.Moments  

Exec= wine ATRI-MyDearMoments-.exe  
</code></pre>
<blockquote>
<p>Type 选择 Application，Name 自定，Exec 指打开快捷方式时运行的命令，Path 表示命令执行的位置（使用Path 的目的与 alias 中给出的理由相同），没什么好解释的，简单易懂。最后，如果你定义的. desktop 文件属于用户条目，即位于 <code>~/.local/share/applications/</code> ，执行以下命令以更新桌面条目；否则就不用管。</p>
</blockquote>
<pre><code class="language-sh">update-desktop-database ~/.local/share/applications
</code></pre>
</li>
</ol>
<h2 id="--2"><a class="anchor" href="#--2">#</a> 😫 偷懒是最大生产力</h2>
<p>邓先生所言：“科技是第一生产力。”我对此不以为然。人类从来都是因偷懒而进步着的。将两人份的劳动缩减为一人份，从每个人中间抠出半个人来，让他们可以懒散度日。就连我们的某某主义也是同样，所谓的“人的自由发展”不正是“不干正事”的别名？</p>
<p>回归正题。要以以上方式运行程序的前提是解锁 Windows 系统硬盘的读写，否则将无法找到应用的路径。每次开机解锁输入密码一整套流程，虽然简单，但我不喜欢。查找了一些资料，对硬盘的认证由 <code>polkit</code> 完成。通过修改对应的操作（actions）即可解除用户的认证，省去了输入密码的程序。</p>
<pre><code class="language-sh"># 修改 .policy 文件
sudo vim /usr/share/polkit-1/actions/org.freedesktop.UDisks2.policy
</code></pre>
<p>找到 <code>org.freedesktop.udisk2.filesystem-mount-system</code> 条目，修改 <code>allow_active</code> 字段值 <code>auth_admin_keep</code> 为 <code>yes</code></p>
<pre><code class="language-sh"># 修改前
&lt;defaults&gt;  
   &lt;allow_any&gt;auth_admin&lt;/allow_any&gt;  
   &lt;allow_inactive&gt;auth_admin&lt;/allow_inactive&gt;  
   &lt;allow_active&gt;auth_admin_keep&lt;/allow_active&gt;  
 &lt;/defaults&gt;

# 修改后
&lt;defaults&gt;  
   &lt;allow_any&gt;auth_admin&lt;/allow_any&gt;  
   &lt;allow_inactive&gt;auth_admin&lt;/allow_inactive&gt;  
   &lt;allow_active&gt;yes&lt;/allow_active&gt;  
 &lt;/defaults&gt;
</code></pre>
<p>重启验证，认证不再需要输入密码。本来想实现开机自动挂载，但是似乎失败了</p>
<blockquote>
<p>通过改写 fstab 文件可以轻易做到，看来当初还是走了不少弯路😢 &ndash;2023-01-20</p>
</blockquote>
<p>算了，继续推阿托莉去。对游戏的感想就留待以后再写。</p>
</article>
    </div>
  </body>
</html>
