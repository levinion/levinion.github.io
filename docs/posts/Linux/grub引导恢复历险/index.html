<!DOCTYPE html>
<html data-theme="dark">
  <head>
    
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" href="/assets/css/pico.css" />
<link rel="stylesheet" href="/assets/css/custom.css" />
<link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script> 


    <style>
      article {
        background: rgb(28, 29, 33);
        max-width: 70%;
        text-align: left;
        margin: 0 auto;
        border-radius: 30px;
      }
      p,
      li {
        font-size: 16.5px;
        line-height: 32px;
      }
      h1 {
        text-align: center;
        margin-bottom: 10px;
      }
      .meta p {
        text-align: center;
      }
      .date {
        text-align: center;
      }
      .toc {
        position: fixed;
        float: left;
        max-width: 50px;
        max-height: 50px;
        margin-top: 200px;
        text-align: center;
      }
      h2 {
        font-size: x-large;
        color: peru;
      }
      h3 {
        font-size: large;
        color: rgb(205, 158, 112);
      }
      h4 {
        font-size: medium;
        color: pink;
      }
      strong {
        color: rgb(182, 230, 240);
      }
    </style>
    <title>Grubå¼•å¯¼æ¢å¤å†é™©</title>
  </head>
  <body onselectstart="return false">
    
<nav>
  <a href="/" class="logo">Maruka's Blog</a>
  <div class="breadcrumb">
    <ul>
      <li>
        <a href="/posts">æ–‡ç« </a>
      </li>
      <li>
        <a href="/category">åˆ†ç±»</a>
      </li>
      <li>
        <a href="/about">å…³äº</a>
      </li>
    </ul>
  </div>
</nav>

    <div>
      <div class="meta">
        <h1>Grubå¼•å¯¼æ¢å¤å†é™©</h1>
        <p>2022-09-17 13:26:26</p>
      </div>
      <article><h2 id="heading"><a class="anchor" href="#heading">#</a> âš äº‹ä»¶çˆ†å‘</h2>
<p>ç”±äº Windows10 çš„ä¸€æ¬¡æ›´æ–°ï¼ŒæˆåŠŸå¤±å»äº† grub å¼•å¯¼ã€‚è¿™æ˜¯ä¸€æ¬¡å†å²æ€§çš„äº‹ä»¶â€”â€”å› ä¸ºæˆ‘å†æ¬¡å›åˆ°äº†åŸæœ¬å• Windows ç³»ç»Ÿçš„ç•…å¿«æ„Ÿä¹‹ä¸­ï¼šæˆ‘å†ä¹Ÿä¸éœ€è¦è¿›è¡Œé€‰æ‹©ä»¥è¿›å…¥ Windows äº†ã€‚ä½œä¸ºä¸–ç•Œçš„ç®¡ç†å‘˜ï¼Œæˆ‘æ— æ³•å®¹å¿ Arch çš„ä¸§å¤±ï¼Œäºæ˜¯è¸ä¸Šäº†å¯»å› grub çš„æ—…ç¨‹ã€‚</p>
<h2 id="heading-1"><a class="anchor" href="#heading-1">#</a> ğŸ•æ—…é€”ç»è¿‡</h2>
<h3 id="-arch-"><a class="anchor" href="#-arch-">#</a> ğŸ’¾åˆ¶ä½œ Arch å¯åŠ¨ç›˜</h3>
<p>ä½œä¸ºä¸€åç®¡ç†å‘˜ï¼Œæˆ‘æ·±çŸ¥è‡ªå·±éœ€è¦åšä»€ä¹ˆã€‚</p>
<p>é¦–å…ˆæˆ‘éœ€è¦é’¥åŒ™â€”â€”ã€å¯åŠ¨ç›˜ã€æ¥å¼€å¯è¿›å…¥ Arch çš„å¤§é—¨ã€‚æˆ‘å…ˆåœ¨ Windows ä¸Šä¸‹è½½äº†æœ€æ–°çš„ Arch é•œåƒï¼Œå¹¶ä¸”ç”¨ Rufus å°†å…¶çƒ§å½•å…¥ U ç›˜ã€‚</p>
<blockquote>
<p>Arch é•œåƒå¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä» <a href="http://mirrors.ustc.edu.cn/">ä¸­ç§‘å¤§å¼€æºé•œåƒç«™</a> ä¸­å¾—åˆ°; ç£ç›˜åˆ¶ä½œå·¥å…·æ¨è <a href="https://rufus.ie/zh/#">Rufus</a>ï¼Œæˆ–è€…ç›´æ¥å®‰è£…<a href="http://www.tbtool.cn/index.html">å›¾å§å·¥å…·ç®±</a>ï¼Œå…¶ä¸­å¸¦æœ‰ Rufus åŠå…¶ä»– Windows ä¸‹å¥½ç”¨çš„å·¥å…·ã€‚</p>
</blockquote>
<h3 id="heading-2"><a class="anchor" href="#heading-2">#</a> ğŸ”°æ­£å¼ä¿®å¤å¼€å§‹å•¦ï¼</h3>
<p>æ’ä¸Š U ç›˜ï¼Œè®¾ç½® Bios ä» U ç›˜å¯åŠ¨ï¼Œæˆ‘å°±å†æ¬¡è¿›å…¥åˆ°äº† Arch çš„ä¸–ç•Œã€‚é‚£è™½ç„¶æ˜¯ä¸€ä¸ªä»€ä¹ˆéƒ½æ²¡æœ‰çš„ã€è¿œå¤çš„ä¸–ç•Œï¼Œæˆ‘è¿˜æ˜¯å¼€å§‹äº†ç´§å¼ çš„å·¥ä½œã€‚</p>
<h4 id="heading-3"><a class="anchor" href="#heading-3">#</a> ğŸ—ºæŸ¥çœ‹ç£ç›˜åˆ†åŒº</h4>
<p><code>fdisk -l</code> å‘½ä»¤æ˜¯ä¸€ä¸ªä»¤äººå…´å¥‹çš„å·¥å…·ï¼Œé”®å…¥åæˆ‘å³å¾—åˆ°äº†ä¸€å¼ æ¸…æ¥šçš„ç£ç›˜åœ°å›¾ã€‚</p>
<pre><code class="language-shell">Device Â Â Â Â Â Â Â Â Â Â Â Â Start Â Â Â Â Â Â Â End Â Â Sectors Â Â Size Type  
/dev/nvme0n1p1 Â Â Â Â Â 2048 Â Â Â Â 534527 Â Â Â 532480 Â Â 260M EFI System  
/dev/nvme0n1p2 Â Â Â 534528 Â Â Â Â 567295 Â Â Â Â 32768 Â Â Â 16M Microsoft reserved  
/dev/nvme0n1p3 Â Â Â 567296 Â 210282495 209715200 Â Â 100G Microsoft basic data  
/dev/nvme0n1p4 210282496 Â 482912255 272629760 Â Â 130G Microsoft basic data  
/dev/nvme0n1p5 998166528 1000214527 Â Â 2048000 Â 1000M Windows recovery environment  
/dev/nvme0n1p6 482912256 Â 503883775 Â 20971520 Â Â Â 10G Linux swap  
/dev/nvme0n1p7 503883776 Â 998166527 494282752 235.7G Linux filesystem
</code></pre>
<p>ä¸€æ—¦æ‹¥æœ‰äº†è¿™å¼ åœ°å›¾ï¼Œæˆ‘å°±å†ä¹Ÿä¸ä¼šè¿·è·¯äº†ã€‚</p>
<blockquote>
<p>grub æ¢å¤è¿‡ç¨‹ä¸­æœ€é‡è¦çš„å½“å± Arch çš„æ ¹ç›®å½•ä»¥åŠ efi ç›®å½•ã€‚å…¶ä¸­æ ¹ç›®å½•æ‰€åœ¨çš„åˆ†åŒºä¸º /dev/nvme0n1p7ï¼Œefi åˆ†åŒºä¸º /dev/nvme0n1p1ã€‚å…·ä½“è¯·æ ¹æ® <code>fdisk -l</code> æ‰€æ˜¾ç¤ºçš„ Type é€‰æ‹©ã€‚</p>
</blockquote>
<h4 id="heading-4"><a class="anchor" href="#heading-4">#</a> â¬†ç›®å½•çš„æŒ‚è½½</h4>
<p>åˆ†åŒºæŒ‚è½½çš„æƒ…å†µå„ä¸ç›¸åŒï¼Œå…·ä½“å¯ä»¥å‚ç…§è‡ªå·±å®‰è£…æ—¶çš„æŒ‚è½½æ–¹å¼ã€‚ç”±äºæˆ‘é‡‡ç”¨äº† btrfs æ–‡ä»¶ç³»ç»Ÿï¼Œåœ¨è¿›è¡Œè¿™é¡¹å·¥ä½œçš„æ—¶å€™ç»•äº†å¼¯è·¯ã€‚</p>
<p>æˆ‘è®°å½•åœ¨ç¾Šçš®çº¸ä¸Šçš„æŒ‚è½½è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-shell"># æŒ‚è½½æ ¹ç›®å½•
mount -t btrfs -o subvol=/@,compress=zstd /dev/nvme0n1p7 /mnt

# æŒ‚è½½å®¶ç›®å½•
mount -t btrfs -o subvol=/@home,compress=zstd /dev/nvme0n1p7 /mnt/home

# æŒ‚è½½ efi ç›®å½•
mount /dev/nvme0n1p1 /mnt/boot/efi
</code></pre>
<p>è‡³æ­¤æˆ‘å°±å·²å®Œæˆäº†æ‰€æœ‰éœ€è¦çš„ç›®å½•æŒ‚è½½ã€‚</p>
<blockquote>
<p>æ­£å¦‚å‰é¢æ‰€è¯´ï¼Œå„äººçš„æŒ‚è½½æ–¹å¼åº”å½“ä»¥å®‰è£…è¿‡ç¨‹ä¸­çš„æŒ‚è½½æ–¹å¼ä¸ºå‡†ã€‚å¦‚æœä½¿ç”¨çš„æ˜¯ btrfs æ–‡ä»¶ç³»ç»Ÿï¼Œå¯ä»¥é‡‡ç”¨ä»¥ä¸Šæ–¹å¼è¿›è¡ŒæŒ‚è½½ï¼›å¦‚æœæ˜¯ä¼ ç»Ÿçš„ ext4ï¼Œå»ºè®®å‚è€ƒä»¥ä¸‹è¿‡ç¨‹ã€‚ä½†å› ä¸ºæˆ‘æ²¡æœ‰å®è·µï¼Œæ‰€ä»¥ä»æœ‰æ— æ³•è§£å†³é—®é¢˜çš„é£é™©ï¼Œå»ºè®®ä¸€å¹¶å‚è€ƒå…¶ä»–èµ„æ–™ã€‚</p>
</blockquote>
<pre><code class="language-shell"># æŒ‚è½½æ ¹ç›®å½•
mount /dev/nvme0n1p7 /mnt

# æŒ‚è½½ boot ç›®å½•
mount /dev/nvme0n1p1 /mnt/boot
</code></pre>
<h4 id="heading-5"><a class="anchor" href="#heading-5">#</a> ğŸ•é‡å»ºå¼•å¯¼</h4>
<p>æ˜¯æ—¶å€™è®©ç§©åºæ¢å¤æ­£å¸¸äº†ï¼</p>
<ol>
<li>åˆ‡æ¢ç³»ç»Ÿç¯å¢ƒ
<pre><code class="language-shell">arch-chroot /mnt
</code></pre>
</li>
<li>ï¼ˆé‡æ–°ï¼‰å®‰è£…ç›¸å…³çš„åŒ…
<pre><code class="language-shell">pacman -S grub efibootmgr os-prober
</code></pre>
</li>
<li>å®‰è£… GRUB åˆ° EFI åˆ†åŒº
<pre><code class="language-shell">grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=ARCH
</code></pre>
</li>
<li>ç”Ÿæˆ grub é…ç½®æ–‡ä»¶
<pre><code>grub-mkconfig -o /boot/grub/grub.cfg
</code></pre>
</li>
</ol>
<p>è‡³æ­¤æ‰€æœ‰å·¥ä½œå°±ç»“æŸäº†ï¼Œå—¯ï¼Œè®©æˆ‘ä»¬å…ˆæ¥æ£€æŸ¥ä¸€ä¸‹å·¥ä½œçš„æˆæœã€‚</p>
<pre><code class="language-shell">Generating grub configuration file ...  
Found theme: /usr/share/grub/themes/Vimix/theme.txt  
Found linux image: /boot/vmlinuz-linux-zen  
Found initrd image: /boot/amd-ucode.img /boot/initramfs-linux-zen.img  
Found fallback initrd image(s) in /boot: Â amd-ucode.img initramfs-linux-zen-fallback.img  
Found linux image: /boot/vmlinuz-linux  
Found initrd image: /boot/amd-ucode.img /boot/initramfs-linux.img  
Found fallback initrd image(s) in /boot: Â amd-ucode.img initramfs-linux-fallback.img  
Warning: os-prober will be executed to detect other bootable partitions.  
Its output will be used to detect bootable binaries on them and create new boot entries.  
Found Windows Boot Manager on /dev/nvme0n1p1@/EFI/Microsoft/Boot/bootmgfw.efi  
Adding boot menu entry for UEFI Firmware Settings ...  
done
</code></pre>
<blockquote>
<p>æ­£å¸¸çš„è¾“å‡ºåº”è¯¥æ˜¯åƒä¸Šé¢ä¸€æ ·ã€‚å¦‚æœä½ æ²¡æœ‰çœ‹è§ Windows å¼•å¯¼é¡¹ï¼Œä¸è¦æ…Œâ€”â€”å› ä¸ºæˆ‘åœ¨é‡å»ºå¼•å¯¼çš„æ—¶å€™ä¹Ÿæ²¡æœ‰çœ‹åˆ°ï¼ˆç¬‘ï¼‰ã€‚è¯·æ¥ç€å¾€ä¸‹çœ‹ã€‚</p>
</blockquote>
<h4 id="heading-6"><a class="anchor" href="#heading-6">#</a> æ”¶å°¾å·¥ä½œ</h4>
<pre><code class="language-shell">exit # é€€å‡º
umount -R /mnt #å¸è½½åˆ†åŒº
reboot #é‡å¯
</code></pre>
<p>ç„¶åä½ åº”è¯¥å°±èƒ½çœ‹åˆ°ç†Ÿæ‚‰çš„ grub ç•Œé¢ã€‚</p>
<blockquote>
<p>å¦‚æœä½ å¤±å»äº† Windows ç™»å½•é€‰é¡¹ï¼Œé‚£ä¹ˆè¿™å¯èƒ½æ˜¯æ¥è‡ª Arch çš„ä¸€ä¸ªå°å°çš„æŠ¥å¤â€”â€”å¼€ç©ç¬‘çš„ã€‚ä½ åªéœ€è¦è¿›å…¥åˆ° Archï¼Œæ‰“å¼€ç»ˆç«¯ï¼Œå¹¶ä¸”é‡æ–°ç”Ÿæˆ grub é…ç½®æ–‡ä»¶å³å¯ã€‚</p>
</blockquote>
<pre><code class="language-shell"> sudo grub-mkconfig -o /boot/grub/grub.cfg
</code></pre>
<h2 id="heading-7"><a class="anchor" href="#heading-7">#</a> ğŸ˜¹ä¸€ä»½å¾ˆè®¤çœŸçš„æ£€è®¨ä¹¦</h2>
<p>è¿™é‡Œæ˜¯æŸå°è®¡ç®—æœºçš„ç®¡ç†å‘˜ï¼Œæˆ‘å¯¹è¿™æ¬¡äº‹æ•…è¡¨ç¤ºååˆ†æŠ±æ­‰ã€‚ä½†æˆ‘ä»ç„¶è®¤ä¸ºï¼Œæƒ©ç½šåº”å½“è½åœ¨ Windows å¤´ä¸Šã€‚å› ä¸ºæˆ‘æ‰€çŠ¯çš„å”¯ä¸€é”™è¯¯å³æ˜¯å‡çº§äº† Windowsã€‚ä½œä¸ºæ­¤æ¬¡äº‹ä»¶çš„æ•™è®­ï¼Œæˆ‘å†³å®šç¦æ­¢ Windows çš„ä¸€åˆ‡æ›´æ–°ï¼Œä»¥ä¸ä½¿åŒæ ·çš„äº‹æ•…å†æ¬¡å‘ç”Ÿï¼</p>
</article>
    </div>
  </body>
</html>
