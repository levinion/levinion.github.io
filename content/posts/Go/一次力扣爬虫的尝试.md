---
title: ä¸€æ¬¡åŠ›æ‰£çˆ¬è™«çš„å°è¯•
created: 2023-02-14 21:02:57
---

## 1 ğŸ¤”æ¬²åšå…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨
æœ€è¿‘å¼€å§‹åˆ·åŠ›æ‰£ï¼Œå¥ˆä½•åŠ›æ‰£çš„é‚£ä¸ªç¼–è¾‘å™¨ï¼ˆmonaco editorï¼‰å®åœ¨ä¸å¥½ç”¨ï¼Œè¿˜æ˜¯ç”¨èµ·äº†å¸¸ç”¨çš„ vscodeã€‚æ¯æ¬¡å¼€å§‹ä¸€é“é¢˜ç›®ä¹‹å‰ä¸å¯é¿å…åœ°éœ€è¦å°†é¢˜ç›®è¦æ±‚å’Œä»£ç å¤åˆ¶åˆ°æœ¬åœ°ï¼Œè€Œè¿™æ ·çš„é‡å¤åŠ³åŠ¨ååˆ†ä»¤äººç”ŸåŒï¼Œäºæ˜¯å¼€ä¸ªé¡¹ç›®ï¼ŒæŠŠä¹‹å‰å†™çš„ç»Ÿè®¡æ–‡ä»¶æ•°çš„å‘½ä»¤è¡Œç¨‹åºæ‰©å±•æˆä¸€ä¸ªçˆ¬è™«å·¥å…·ã€‚

## 2 ğŸ§°å·¥å…·å’ŒåŸºç¡€ä»£ç 
ç”±äºä¸ªäººä¸»è¦ä½¿ç”¨ go è¯­è¨€ï¼Œå› æ­¤çˆ¬è™«ä¹Ÿé€‰æ‹©ä½¿ç”¨ go æ¥å®ç°ï¼›å¦‚æœä½ ä½¿ç”¨å…¶ä»–è¯­è¨€ï¼Œä¹Ÿå¯ä»¥å‚è€ƒè¯¥å®ç°çš„ä¸»è¦æ€è·¯ã€‚è¯¥å‘½ä»¤è¡Œå·¥å…·ä½¿ç”¨ cobra æ¡†æ¶å®Œæˆï¼Œä½†é‚£å¹¶éè¦è®¨è®ºçš„å†…å®¹ã€‚è®©æˆ‘ä»¬çœ‹çœ‹çˆ¬è™«éƒ¨åˆ†ã€‚

### 2.1 req
req æ˜¯ go è¯­è¨€çˆ¬è™«çš„æœ€ä½³å®è·µä¹‹ä¸€ï¼Œå…¶æ“ä½œååˆ†ç®€å•ã€‚åœ¨çˆ¬è™«éƒ¨åˆ†ä¸­ï¼Œæ ¸å¿ƒç¯èŠ‚å³æ˜¯ç”± req å®ç°çš„ query è¯·æ±‚å‡½æ•°ã€‚è®©æˆ‘ä»¬çœ‹çœ‹ä»£ç ï¼š

```go
func query(bodyJsonString string) *req.Response {
	res, err := req.C().R().
		//csrfæ ‡å¤´è®¾ç½®
		SetHeader("x-csrftoken",
			"**********************************************************").
		SetHeader("referer", "https://leetcode.cn/problems").
		SetBodyJsonString(bodyJsonString).
		Post("https://leetcode.cn/graphql/")
	checkErr(err)
	return res
}
```

åœ¨è¯¥æ®µä»£ç ä¸­ï¼Œä½¿ç”¨ `.C()` è·å–ä¸€ä¸ªçˆ¬è™«å®¢æˆ·ç«¯ï¼Œä½¿ç”¨ `.R()` è·å–è¯·æ±‚ï¼Œç„¶åè®¾ç½®å¿…è¦çš„ `Header` å’Œè¯·æ±‚ä½“ï¼Œæœ€åä½¿ç”¨ `Post` æ–¹æ³•å‘èµ·è¯·æ±‚ï¼Œå¾—åˆ°ä¸€ä¸ªå¯è¿›è¡Œåç»­å¤„ç†çš„ `Response` ç»“æ„ä½“æŒ‡é’ˆã€‚è¯¦ç»†å†…å®¹ä¸‹é¢ä¼šè®²ã€‚

### 2.2 json æ ¼å¼æ•°æ®å¤„ç†
å½“æˆ‘ä»¬å¾—åˆ°äº†è¯·æ±‚åˆ°çš„æ•°æ®ï¼Œä½ ä¼šå‘ç°å®ƒæ˜¯ä¸€ä¸ª json æ ¼å¼çš„å­—ç¬¦ä¸²ã€‚æˆ‘ä»¬éœ€è¦ä»è¯¥ json æ ¼å¼æ•°æ®ä¸­å¾—åˆ°æˆ‘ä»¬éœ€è¦çš„ä¿¡æ¯ï¼Œå¦‚é¢˜å·ã€é¢˜ç›®è¦æ±‚ã€é¢˜ç›®ä»£ç ç­‰ã€‚åœ¨ go ä¸­ï¼Œä¸€ä¸ªå¾ˆæ–¹ä¾¿çš„å®è·µæ˜¯ gjsonã€‚è€Œå½“æˆ‘ä»¬æƒ³è¦ä¿®æ”¹ json å­—ç¬¦ä¸²æ—¶ï¼ˆä½ ä¼šå‘ç°æˆ‘ä»¬ç¡®å®éœ€è¦ï¼‰ï¼Œsjson åˆ™æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ã€‚åœ¨è·å–ç‰¹å®šé¢˜ç›®æ ‡é¢˜æ—¶ï¼Œæˆ‘ä½¿ç”¨äº† gjson ä»¥è·å–æ ‡é¢˜å’Œéš¾åº¦ç­‰çº§ã€‚

```go
func GetSlug(index int) (slug, diff string) {
	res := query(slugPayload)
	jsonString := res.String()
	baseFindPath := fmt.Sprintf("data.allQuestionsBeta.#(questionId=%d)", index)
	slugFindPath := baseFindPath + ".titleSlug"
	diffFindPath := baseFindPath + ".difficulty"
	slug = gjson.Get(jsonString, slugFindPath).String()
	diff = gjson.Get(jsonString, diffFindPath).String()
	return
}
```

## 3 ğŸ›å¼€å§‹çˆ¬å–æ•°æ®
OKï¼Œåˆ°è¿™é‡Œä½ å·²ç»çŸ¥é“äº†è¯¥ä½¿ç”¨ä»€ä¹ˆå·¥å…·ï¼Œè€Œæˆ‘ä»¬çš„çˆ¬è™«æ•™ç¨‹ä¹Ÿç»ˆäºå¯ä»¥æ­£å¼å¼€å§‹äº†ï¼

### 3.1 çˆ¬å–ç‰¹å®šé¢˜ç›®ä¿¡æ¯

é¦–å…ˆè®©æˆ‘ä»¬å…ˆçˆ¬å–ç‰¹å®šé¢˜ç›®çš„æœ‰ç”¨ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯å¯èƒ½åŒ…æ‹¬é¢˜ç›®çš„é¢˜å·ã€éš¾åº¦ã€ä»£ç ã€éœ€æ±‚å’Œæ ‡é¢˜ï¼Œä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œå°†å®ƒä»¬åŠ å…¥ä¸€ä¸ªç»“æ„ä½“ã€‚

```go
type Data struct {
	Index  int
	Diff   string
	CodeR  string
	NeedR  string
	TitleR string
}
```

å½“ä½ è¿›å…¥åŠ›æ‰£å¹¶ä¸”æ‰“å¼€ä¸€ä¸ªå…·ä½“çš„é¢˜ç›®ï¼ˆè¿™é‡Œä»¥å¤§å®¶ç†ŸçŸ¥çš„â€œ[ä¸¤æ•°ä¹‹å’Œ](https://leetcode.cn/problems/two-sum/)â€ä¸ºä¾‹ï¼‰ï¼ŒæŒ‰ `F12` æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼Œä¾æ¬¡ç‚¹å‡»ç½‘ç»œå’Œ `XHR`ï¼Œä½ ä¼šå‘ç°å¾ˆå¤š `graphql/`ï¼Œè¿™äº›å³æ˜¯åŠ›æ‰£çš„ `api` è¯·æ±‚ä¿¡æ¯ã€‚åœ¨ä»”ç»†æ£€æŸ¥æ¯é¡¹çš„æ•°æ®å†…å®¹åå°±èƒ½å¤Ÿå‘ç°è®°å½•ç€å…¨éƒ¨æˆ‘ä»¬æ‰€éœ€è¦ä¿¡æ¯çš„æ•°æ®ï¼š

```json
data: {,â€¦}
    question: {questionId: "1", questionFrontendId: "1", categoryTitle: "Algorithms", boundTopicId: 2,â€¦}
```

æ¥ç€æˆ‘ä»¬å°±å¯ä»¥æŸ¥çœ‹æ ‡å¤´ï¼Œè®°å½•è¯·æ±‚åœ°å€ï¼ˆæ­¤å¤„ä¸º `https://leetcode.cn/graphql/`ï¼‰ã€`crsftoken` å’Œ `referer`ï¼Œå¹¶ä¸”è®¾ç½®çˆ¬è™«çš„ `Header`ï¼Œå¹¶å¤åˆ¶è¯·æ±‚è½½è·ä¿¡æ¯ä½œä¸ºè¯·æ±‚ä½“ï¼Œä»¥ä¸Šé¢çš„åœ°å€å‘é€ `POST` è¯·æ±‚ï¼š

```go
func query(bodyJsonString string) *req.Response {
	res, err := req.C().R().
		//csrfæ ‡å¤´è®¾ç½®
		SetHeader("x-csrftoken",
			"**********************************************************").
		SetHeader("referer", "https://leetcode.cn/problems").
		SetBodyJsonString(bodyJsonString).
		Post("https://leetcode.cn/graphql/")
	checkErr(err)
	return res
}
```

å…¶ä¸­è¯·æ±‚ä½“å¯ä»¥è‡ªå®šä¹‰è¯·æ±‚é¡¹ï¼Œåªè·å–æˆ‘ä»¬å¯èƒ½ç”¨å¾—ä¸Šçš„å…³é”®æ•°æ®ï¼š

```json
//è¯·æ±‚ä½“
{
  "operationName": "questionData",
  "variables": {
    "titleSlug": "two-sum"
  },
  "query": "query questionData($titleSlug: String!) {         question(titleSlug: $titleSlug) {\n             questionId\n             categoryTitle\n             title\n             titleSlug\n             translatedTitle\n             translatedContent\n             isPaidOnly\n             difficulty\n                codeSnippets\n {                 lang\n                 langSlug\n                 code\n             }         }     }"
}
```

è¿™æ ·æˆ‘ä»¬å°±åœ¨ `res` ä¸­è·å¾—äº†åœ¨æµè§ˆå™¨ä¸­æŠ“åŒ…å¾—åˆ°çš„åŒæ ·çš„ json æ•°æ®ï¼Œä½ å¯ä»¥ä½¿ç”¨ `res.String()` å°†å®ƒæ‰“å°å‡ºæ¥ä»¥è¿›è¡ŒéªŒè¯ï¼›æˆ‘ä»¬è¿™é‡Œå°±ä¸è¿™æ ·åšäº†ã€‚ç„¶åä½¿ç”¨ `gjson` æå–æˆ‘ä»¬éœ€è¦çš„æ•°æ®ï¼š

```go
func GetInter(slug, codeType string) (string, string, string) {
	interPayload, err := sjson.Set(interPayload, "variables.titleSlug", slug)
	checkErr(err)
	res := query(interPayload)

	jsonString := res.String()
	codeTypeCode := model.CodeTypeMap[codeType]
	code := fmt.Sprintf("data.question.codeSnippets.%v.code", codeTypeCode)
	need := "data.question.translatedContent"
	title := "data.question.translatedTitle"
	codeR := gjson.Get(jsonString, code).String()
	needR := gjson.Get(jsonString, need).String() //html
	titleR := gjson.Get(jsonString, title).String()
	return codeR, needR, titleR
}
```

`gjson` çš„ä½¿ç”¨æ–¹æ³•å¾ˆç®€å•ï¼šå®ƒçš„åŸºæœ¬ä½¿ç”¨æ–¹å¼æ˜¯ `gjson.Get(jsonå­—ç¬¦ä¸²ï¼ŒæŸ¥æ‰¾å­—ç¬¦ä¸²)`ï¼Œå®ƒèƒ½å¤Ÿé€šè¿‡ `çˆ¶å…ƒç´ å.å­å…ƒç´ å` ä»¥è·å–å­å…ƒç´ çš„å€¼ã€‚è‡³äºå¦‚ `#(questionId=1)` åˆ™æ˜¯è·å–æ•°ç»„å†…å±æ€§ `questionId` ä¸º 1 çš„å…ƒç´ ã€‚æœ€åä½¿ç”¨ `.String()` æ–¹æ³•å°†å…¶è½¬åŒ–ä¸ºå­—ç¬¦ä¸²ã€‚

ç”±ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å°±è·å–äº†ç‰¹å®šé¢˜ç›®çš„ä»£ç ï¼Œéœ€æ±‚å’Œæ ‡é¢˜ã€‚

ä½†æ˜¯æˆ‘ä»¬å¦‚ä½•çˆ¬å–å…¶ä»–é¢˜ç›®å‘¢ï¼Ÿæˆ‘ä»¬å‘ç°æ¶‰åŠé¢˜ç›®æ ‡é¢˜çš„è¯·æ±‚ä¿¡æ¯åªæœ‰ `referer` å’Œè¯·æ±‚ä½“çš„ `titleSlug`ï¼Œè€Œä¿®æ”¹ `referer` ä¼¼ä¹æ˜¯ä¸èµ·ä½œç”¨çš„ï¼Œé‚£ä¹ˆçœŸæ­£åŒºåˆ†ä¸åŒé¢˜ç›®çš„å°±åªæœ‰ `titleSlug` çš„å€¼ã€‚åªè¦åˆ©ç”¨ `sjson` å°†å…¶ä¿®æ”¹ä¸ºå…¶ä»–é¢˜ç›®çš„æ ‡é¢˜ï¼Œæˆ‘ä»¬ç¡®å®æ‹‰å–åˆ°äº†å…¶ä»–é¢˜ç›®çš„ä¿¡æ¯ã€‚

### çˆ¬å–å…¨éƒ¨é¢˜ç›®åˆ—è¡¨
è‡³æ­¤æˆ‘ä»¬å·²ç»èƒ½å¤Ÿæ ¹æ®æ ‡é¢˜å–å¾—æˆ‘ä»¬éœ€è¦çš„æ•°æ®äº†ï¼Œä½†æ¯æ¬¡ä¼ å…¥æ ‡é¢˜çš„å½¢å¼å¹¶ä¸é«˜æ•ˆï¼Œæ›´ä½•å†µè¿˜æ˜¯ slug æ ¼å¼çš„æ ‡é¢˜ã€‚æˆ‘ä»¬æ‰€éœ€è¦çš„æ˜¯æ ¹æ®é¢˜å·çˆ¬å–é¢˜ç›®ä¿¡æ¯ã€‚

è¿˜æ˜¯å›åˆ°[ä¸¤æ•°ä¹‹å’Œ](https://leetcode.cn/problems/two-sum/)è¿™ä¸ªé¡µé¢ï¼Œå¦‚æœä½ è¶³å¤Ÿä»”ç»†çš„è¯ï¼Œä½ å¯èƒ½æ—©å°±å‘ç°äº†ä»¥ä¸‹çš„ json ä¿¡æ¯ï¼š

```json
{data: {allQuestionsBeta: [{questionId: "1", __typename: "QuestionNode", status: "ac"},â€¦]}}
```

è¯¥ä¿¡æ¯ä¸­ç»´æŠ¤äº†å…¨éƒ¨çš„é¢˜ç›®ä¿¡æ¯ï¼Œé€‚å½“ä¿®æ”¹å…¶è¯·æ±‚ä½“ä»¥è·å– `slug` æ ¼å¼æ ‡é¢˜ï¼Œå½“ç„¶è¿™ä¹Ÿå¯åŒ…æ‹¬å…¶ä»–æ•°æ®ï¼š

```json
{"operationName": "allQuestions", "query": "query allQuestions {  allQuestionsBeta {    ...questionSummaryFields    __typename  }}fragment questionSummaryFields on QuestionNode {  title  titleSlug  translatedTitle  questionId  difficulty  __typename}"}
```

> ç»†å¿ƒçš„åŒå­¦å¯èƒ½æ³¨æ„åˆ°ï¼Œä¸ºä½•æˆ‘ä»¬ä¸åœ¨è¿™é‡Œå–å¾—é¢˜ç›®å…·ä½“çš„ä¿¡æ¯ï¼Œå¦‚codeå’Œneedä¹‹ç±»çš„å‘¢ï¼Ÿä¸ºä½•æˆ‘ä»¬è¿˜éœ€è¦ç»´æŠ¤ä¸€ä¸ªè¯·æ±‚ä¸“é—¨çˆ¬å–ä¸Šé¢ä¸¤ä¸ªæ•°æ®å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºæˆ‘åœ¨ä¿®æ”¹ä¸Šé¢è¯·æ±‚ä½“çš„è¿‡ç¨‹ä¸­å‘ç°åªè¦è¯·æ±‚äº†ä»¥ä¸Šä»»ä½•ä¸€ä¸ªæ•°æ®å°±ä¼šæŠ¥é”™ï¼Œå› æ­¤ä¸å¾—ä¸è¿™æ ·åšï¼Œè™½ç„¶å¯èƒ½å› æ­¤æ‹–æ…¢äº†ç¨‹åºçš„é€Ÿåº¦ï¼ˆæ¯•ç«Ÿè¦çˆ¬ä¸¤æ¬¡å‘¢ï¼‰ã€‚

äºæ˜¯æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨å®ƒå–å¾—é¢˜å·å¯¹åº”çš„æ ‡é¢˜ï¼š

```go
func GetSlug(index int) (slug, diff string) {
	res := query(slugPayload)
	jsonString := res.String()
	baseFindPath := fmt.Sprintf("data.allQuestionsBeta.#(questionId=%d)", index)
	slugFindPath := baseFindPath + ".titleSlug"
	diffFindPath := baseFindPath + ".difficulty"
	slug = gjson.Get(jsonString, slugFindPath).String()
	diff = gjson.Get(jsonString, diffFindPath).String()
	return
}
```

é™¤å¼€ä»¥ä¸Šå…³é”®ç¯èŠ‚å°±åªå‰©ä¸‹ä¸€äº›æ–‡ä»¶æ“ä½œï¼ˆä»¥åŠä¸€äº›ç®€å•çš„uiï¼‰ï¼Œæœ€åçˆ¬è™«éƒ¨åˆ†æœ€ç»ˆä»£ç å¦‚ä¸‹ï¼š
```go
func Get(index int) {
	t := timer.NewTimer()
	t.Start()
	config.ReadConfig()
	codeType := viper.GetString("codeType")
	slug, diff := query.GetSlug(index)
	codeR, needR, titleR := query.GetInter(slug, codeType)
	data := &model.Data{Index: index, Diff: diff, CodeR: codeR, NeedR: needR, TitleR: titleR}
	codeDir := viper.GetString("codeDir")

	var dir string
	if viper.GetBool("moduled") {
		diff := strings.ToLower(data.Diff)
		dir = filepath.Join(codeDir, diff, strconv.Itoa(data.Index)+"."+data.TitleR)
	} else {
		dir = filepath.Join(codeDir, strconv.Itoa(data.Index)+"."+data.TitleR)
	}
	os.MkdirAll(dir, os.ModePerm)
	codeFilename := "main." + codeType
	codeFilePath := filepath.Join(dir, codeFilename)
	needFilePath := filepath.Join(dir, "need.md")
	if !isExist(codeFilePath) {
		color.Cyan("è¯·å‹¿é‡å¤æ‹‰å–æ–‡ä»¶")
		return
	} else {
		cfile, err := os.Create(codeFilePath)
		checkErr(err)
		defer cfile.Close()
		info := viper.GetString("append.prefix") + data.CodeR
		cfile.WriteString(info)
	}
	if viper.GetBool("function.useNeed") {
		if !isExist(needFilePath) {
			color.Cyan("è¯·å‹¿é‡å¤æ‹‰å–æ–‡ä»¶")
			return
		} else {
			nfile, err := os.Create(needFilePath)
			checkErr(err)
			defer nfile.Close()
			nfile.WriteString(needR)
		}
	}
	t.Stop()
}
```



